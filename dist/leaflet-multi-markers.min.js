!function(factory){if("function"==typeof define&&define.amd)define(["leaflet"],factory);else if("object"==typeof exports)module.exports=factory(require("leaflet"));else if("undefined"!=typeof window){if(void 0===window.L)throw"Leaflet must be loaded first.";window.L.MultiMarkers=factory(window.L)}}(function(L){let MultiMarkers=L.LayerGroup.extend({options:{iconExFields:["iconScale","iconHtml","iconHtmlSize","iconHtmlAnchor","iconHtmlPopupAnchor","iconFill","iconOpacity","iconStroke","iconStrokeOpacity","backgroundHtml","backgroundHtmlSize","backgroundHtmlAnchor","backgroundFill","backgroundOpacity","contentHtml","contentHtmlSize","contentHtmlAnchor","contentColor","contentFontSize"],iconExPredefined:void 0,setIconExOptions:void 0,markerOptions:void 0,setMarkerOptions:void 0,bindPopup:!0,defaultPopupContent:"",getStaticPopupContent:void 0,fetchDynamicPopupContent:void 0,onClick:void 0},initialize(data,options){L.Util.setOptions(this,options),this._layers={},data&&data.forEach(elem=>this.addMarker(elem))},addMarker(elem){let iconOptions={},markerOptions=(this.options.iconExPredefined&&("default"in this.options.iconExPredefined&&(iconOptions={...this.options.iconExPredefined.default}),elem.hasOwnProperty("iconExName"))&&elem.iconExName in this.options.iconExPredefined&&(iconOptions={...iconOptions,...this.options.iconExPredefined[elem.iconExName]}),iconOptions=this.options.iconExFields.reduce((acc,key)=>(elem.hasOwnProperty(key)&&elem[key]&&(acc[key]=elem[key]),acc),{...iconOptions}),this.options.setIconExOptions&&(iconOptions={...iconOptions,...this.options.setIconExOptions(elem)}),{}),marker=(this.options.markerOptions&&(markerOptions={...this.options.markerOptions}),(markerOptions=this.options.setMarkerOptions?{...markerOptions,...this.options.setMarkerOptions(elem)}:markerOptions).icon=new L.IconEx(iconOptions),new L.Marker([elem.lat,elem.lng],markerOptions));var content;return marker.elem=elem,this.options.onClick&&marker.on("click",this.options.onClick),this.options.bindPopup&&(this.options.defaultPopupContent||this.options.getStaticPopupContent)&&!this.options.fetchDynamicPopupContent?(content=this.options.getStaticPopupContent?this._getStaticPopupContentWrapper(void 0):this._defaultPopupContentWrapper(void 0),marker.bindPopup(content)):this.options.bindPopup&&this.options.fetchDynamicPopupContent&&marker.bindPopup(()=>{let id=this._getRandomDivId();var content=this.options.getStaticPopupContent?this._getStaticPopupContentWrapper(id)(marker):this._defaultPopupContentWrapper(id);return marker.once("popupopen",()=>{var div=document.getElementById(id);div&&this._fetchDynamicPopupContentWrapper(marker,div)}),content}),L.LayerGroup.prototype.addLayer.call(this,marker)},_defaultPopupContentWrapper:function(id){return`<div class="leaflet-multi-markers-popup"${id?` id="${id}"`:""}>${this.options.defaultPopupContent}</div>`},_getStaticPopupContentWrapper:function(id){return marker=>`<div class="leaflet-multi-markers-popup"${id?` id="${id}"`:""}>${this.options.getStaticPopupContent(marker)}</div>`},_fetchDynamicPopupContentWrapper:function(marker,div){let content;this.options.fetchDynamicPopupContent(marker).then(html=>{content=html}).catch(err=>{content=err}).finally(()=>{div.outerHTML=`<div class="leaflet-multi-markers-popup">${content}</div>`,marker.getPopup()._updateLayout(),marker.getPopup()._updatePosition()})},_getRandomDivId:function(){return`leaflet-multi-markers-${Date.now()}-`+Math.round(1e3*Math.random())}});return L.multiMarkers=function(data,options){return new MultiMarkers(data,options)},MultiMarkers});