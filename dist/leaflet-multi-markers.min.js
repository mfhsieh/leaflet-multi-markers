!function(factory){if("function"==typeof define&&define.amd)define(["leaflet"],factory);else if("object"==typeof exports)module.exports=factory(require("leaflet"));else if("undefined"!=typeof window){if(void 0===window.L)throw"Leaflet must be loaded first.";window.L.MultiMarkers=factory(window.L)}}(function(L){let MultiMarkers=L.LayerGroup.extend({options:{iconExFields:["iconScale","iconHtml","iconHtmlSize","iconHtmlAnchor","iconHtmlPopupAnchor","iconFill","iconOpacity","iconStroke","iconStrokeOpacity","backgroundHtml","backgroundHtmlSize","backgroundHtmlAnchor","backgroundFill","backgroundOpacity","contentHtml","contentHtmlSize","contentHtmlAnchor","contentColor","contentFontSize"],iconExPredefined:void 0,setIconExOptions:void 0,bindPopup:!0,defaultContent:"",getStaticContent:void 0,fetchDynamicContent:void 0,onClick:void 0},initialize(data,options){L.Util.setOptions(this,options),this._layers={},data&&data.forEach(elem=>{this.addMarker(elem)})},addMarker(elem){let iconOptions={},marker=(this.options.iconExPredefined&&("default"in this.options.iconExPredefined&&(iconOptions=this.options.iconExPredefined.default),elem.hasOwnProperty("iconExName"))&&elem.iconExName in this.options.iconExPredefined&&(iconOptions={...iconOptions,...this.options.iconExPredefined[elem.iconExName]}),iconOptions=this.options.iconExFields.reduce((acc,key)=>(elem.hasOwnProperty(key)&&elem[key]&&(acc[key]=elem[key]),acc),{...iconOptions}),this.options.setIconExOptions&&(iconOptions={...iconOptions,...this.options.setIconExOptions(elem)}),new L.Marker([elem.lat,elem.lng],{icon:new L.IconEx(iconOptions)}));var content;return marker.elem=elem,this.options.onClick&&marker.on("click",this.options.onClick.bind(null,marker)),this.options.bindPopup&&(this.options.defaultContent||this.options.getStaticContent)&&!this.options.fetchDynamicContent?(content=this.options.getStaticContent?this._getStaticContentWrapper(void 0):this._defaultContentWrapper(void 0),marker.bindPopup(content)):this.options.bindPopup&&this.options.fetchDynamicContent&&marker.bindPopup(()=>{let id=this._getRandomDivId();var content=this.options.getStaticContent?this._getStaticContentWrapper(id)(marker):this._defaultContentWrapper(id);return marker.once("popupopen",()=>{var div=document.getElementById(id);div&&this._fetchDynamicContentWrapper(marker,div)}),content}),L.LayerGroup.prototype.addLayer.call(this,marker)},_defaultContentWrapper:function(id){return`<div class="leaflet-multi-markers-popup"${id?` id="${id}"`:""}>${this.options.defaultContent}</div>`},_getStaticContentWrapper:function(id){return marker=>{marker=this.options.getStaticContent(marker);return`<div class="leaflet-multi-markers-popup"${id?` id="${id}"`:""}>${marker}</div>`}},_fetchDynamicContentWrapper:function(marker,div){let content;this.options.fetchDynamicContent(marker).then(html=>{content=html}).catch(err=>{content=err}).finally(()=>{div.outerHTML=`<div class="leaflet-multi-markers-popup">${content}</div>`,marker.getPopup()._updateLayout(),marker.getPopup()._updatePosition()})},_getRandomDivId:function(){return`leaflet-multi-markers-${Date.now()}-`+Math.round(1e3*Math.random())}});return L.multiMarkers=function(data,options){return new MultiMarkers(data,options)},MultiMarkers});